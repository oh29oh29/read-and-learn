# 14. 컴포넌트 결합

컴포넌트 사이의 관계를 설명하는 세 가지 원칙.

### ADP: 의존성 비순환 원칙

컴포넌트 의존성 그래프에 순환이 있어서는 안 된다. 

컴포넌트 사이에서 순환이 일어나면 안된다고 한다.  
하나의 컴포넌트만 수정해도 순환 의존성을 갖는 다른 컴포넌트까지 영향을 미치기 때문에 사실상 하나의 거대한 컴포넌트가 되어 버린다.  

아래와 같은 순환 의존성을 갖는 컴포넌트들이 존재한다고 할때  
![순환 의존성을 갖는 컴포넌트들](images/IMG_14_1.jpg)

컴포넌트 사이의 순환을 끊어야 하는데, 방법은 두 가지 정도 존재한다.
1. 의존성 역전 원칙(DIP)을 적용한다.  
User가 필요로 하는 메서드를 제공하는 인터페이스를 Entities 컴포넌트 안에 생성하고, 해당 인터페이스를 상속받는 클래스를 Autorizer 컴포넌트 안에 생성한다.  
이렇게 하면 Entities와 Authorizer 컴포넌트 사이의 의존성을 역전시킬 수 있고, 순환을 끊을 수 있다.
![DIP로 순환을 끊는 컴포넌트들](images/IMG_14_2.jpg)
 
2. Entities와 Authorizer가 모두 의존하는 새로운 컴포넌트를 만든다.  
두 컴포넌트가 모두 의존하는 클래스들을 새로운 컴포넌트로 이동시킨다.  
![새로운 컴포넌트로 순환을 끊는 컴포넌트들](images/IMG_14_3.jpg)
   

요구사항이 변경되면 컴포넌트 구조도 변경될 수 있다.  
애플리케이션이 성장함에 따라 컴포넌트 의존성 구조는 서서히 흐트러지며 또 성장한다.  
순환이 발생하면 끊어야 하며, 그렇게 되면 때론 새로운 컴포넌트를 생성하거나 의존성 구조가 더 커질 수 있다.

### SDP: 안정된 의존성 원칙

안정성의 방향으로(더 안정된 쪽에) 의존하라.

변경이 쉽지 않은 컴포넌트가 변동이 예상되는 컴포넌트에 의존하게 만들어서는 절대로 안된다.  
안정된 의존성 원칙(Stable Dependencies Principle, SDP)을 준수하면 변경하기 어려운 모듈이 변경하기 쉽게 만들어진 모듈에 의존하지 않도록 만들 수 있다.

컴포넌트를 변경하기 어렵게 만드는 확실한 방법 중 하나는 다수의 다른 컴포넌트가 해당 컴포넌트를 의존하게 만드는 것이다.  
컴포넌트 안쪽으로 들어오는 의존성이 많아지면 상당히 안정적이라고 볼 수 있다.  

![안정된 컴포넌트 X](images/IMG_14_4.jpg)  
안정된 컴포넌트 X

![불안정한 컴포넌트 Y](images/IMG_14_5.jpg)  
불안정한 컴포넌트 Y

모든 컴포넌트가 안정적이어야 하는 것은 아니다.  
불안정한 컴포넌트도 있고 안정된 컴포넌트도 있는게 당연하며 불안정한 컴포넌트가 안정된 컴포넌트를 의존하도록 구성된 시스템이 이상적이다.

![이상적인 구성](images/IMG_14_6.jpg)    
이상적인 구성

![SDP 위배](images/IMG_14_7.jpg)  
SDP 위배

![해결책](images/IMG_14_8.jpg)  
해결책

UServer와 같은 인터페이스만을 포함하는 추상 컴포넌트는 상당히 안정적이며, 덜 안정적인 컴포넌트가 의존할 수 있는 이상적인 대상이다.  
