# 18. 상속보다는 컴포지션을 사용하라

상속은 코드를 재사용하는 강력한 수단이지만, 잘못 사용하면 오류를 내기 쉬운 소프트웨어를 만들게 된다.  
여기서 말하는 상속이란, 클래스가 다른 클래스를 확장하는 구현 상속을 의미한다.

#### 안전한 상속
- 상위 클래스와 하위 클래스가 모두 같은 패키지 안에 존재
- 확장할 목적으로 설계되었고 문서화도 잘 된 클래스

다른 패지키의 클래스를 상속하는 일은 위험하다.

**상속은 캡슐화를 깨뜨린다.**  
상위 클래스의 내부 구현이 달라지면 그 영향으로 변경하지 않은 하위 클래스가 오동작할 수 있다.

상속으로 인해 발생할 수 있는 문제점을 피해가는 방법이 있다.  

기존 클래스를 상속하는 대신, 새로운 클래스를 만들고 private 필드로 기존 클래스의 인스턴스를 참조하게 하자.
기존 클래스가 새로운 클래스의 구성요소로 쓰인다는 뜻에서 이러한 설계를 컴포지션(composition)이라 한다.

새 클래스의 메서드들은 private 필드로 참조하는 기존 클래스의 대응하는 메서드를 호출해 그 결과를 반환한다. 
이 방식을 전달(forwarding)이라 하며, 새 클래스의 메서드들을 forwarding method 라 부른다.

#### 컴포지션 장점
새 클래스는 기존 클래스의 내부 구현 방식의 영향에서 벗어날 수 있다.  
기존 클래스에 새로운 메서드가 추가되더라도 전혀 영향받지 않는다.

컴포지션과 전달의 조합은 넓은 의미로 위임(delegation)이라고 부른다.  
단, 엄밀히 따지면 래퍼 객체가 내부 객체에 자기 자신의 참조를 넘기는 경우만 위임에 해당한다.

상속은 반드시 하위 클래스가 상위 클래스의 '진짜' 하위 타입인 상황에서만 쓰여야 한다.  
즉, 클래스 B 가 클래스 A 와 is-a 관계일 때만 클래스 A 를 상속해야 한다.

컴포지션을 써야 할 상황에서 상속을 사용하는 건 내부 구현을 불필요하게 노출하는 꼴이다.  
그 결과 API 가 내부 구현에 묵이고 그 클래스의 성능도 영원히 제한된다.