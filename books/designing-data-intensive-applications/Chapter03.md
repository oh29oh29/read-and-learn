# 저장소와 검색

해당 장에서는 **데이터베이스가 데이터를 저장하는 방법과 데이터를 요청했을 때 다시 찾을 수 있는 방법**을 설명한다.

- RDB와 NoSQL라 불리는 데이터베이스에 사용되는 저장소 엔진에 대해 설명한다.
- 로그 구조(log-structured) 계열 저장소 엔진과 B-tree 같은 페이지 지향(page-oriented) 계열 저장소 엔진을 검토한다.

### 데이터베이스를 강력하게 만드는 데이터 구조

많은 데이터베이스는 내부적으로 추가 전용(append-only) 데이터 파일인 로그(log)를 사용한다.  

로그만으로는 부족하다.  
로그는 많은 레코드가 있으면 성능이 매우 좋지 않다.  
⇒ 매번 키를 찾을 때마다 존재하는지 찾기 위해 전체 데이터베이스 파일을 처음부터 끝까지 스캔해야 한다.  
⇒ 검색 비용 O(n)

#### 색인

데이터베이스에서 특정 키의 값을 효율적으로 찾기 위한 데이터 구조.  
다양한 색인 구조가 존재한다.

색인의 일반적인 개념은 **어떤 부가적인 메타데이터를 유지**하는 것이다.  
메타데이터는 이정표 역할을 해서 원하는 데이터의 위치를 찾는데 도움을 준다.

다만, 색인은 쓰기 과정에서 오버헤드가 발생한다.  
데이터를 쓸 때마다 매번 색인도 갱신해야 하기 때문에 대개 쓰기 속도를 느리게 만든다.

#### B-트리

가장 널리 사용되는 색인 구조  
`key`로 정렬된 key-value 형태로 유지하기 때문에 key-value 검색과 범위 질의에 효율적이다.  

B-트리는 (일반적으로) 4KB 크기의 고정 크기 페이지로 나누고 한 번에 하나의 페이제 읽기 또는 쓰기를 한다.  
각 페이지는 주소나 위치를 이용해 식별할 수 있다.  

한 페이지는 B-트리의 `root`로 지정된다.  
색인에서 `key`를 찾으려면 `root`에서 시작한다.  
페이지는 여러 `key`와 하위 페이지의 `reference`를 포함한다.

