# 02. 엔티티     
    
## 고유 식별자
엔티티 설계 초기에는 고유 식별자의 중심을 이루는 특성과 행동, 쿼리하는데 도움을 주는 요소에 집중한다.    
시간이 흘러도 고유성(uniqueness)이 보장될 수 있도록 식별자를 구현하는 다양한 옵션의 확보는 아주 중요한 일이다.    
    
#### 식별자 생성의 시점이 문제가 될 때    
 식별자는 객체 구성의 일부로서 일찍 생성되거나 영속성의 일부로서 늦게 생성될 수 있다.    
    
시점이 문제가 되는 경우    

> 클라이언트가 외부로의 도메인 이벤트를 구독하는 시나리오 
>
> 새로운 Product 인스턴스화가 완료됨에 따라 이벤트가 발생한다.  
> 클라이언트는 게시된 이벤트를 이벤트 저장소에 저장한다.  
> 저장된 이벤트는 바운디드 컨텍스트 외부의 구독자에게 알림 형태로 게시된다.
>
> 다시 말하면,  
> 클라이언트가 새로운 Product를 ProductRepository에 추가할 기회를 잡기 전에 도메인 이벤트를 수신한다.
> 도메인 이벤트가 올바르게 초기화되기 위해선 식별자 생성을 빠르게 완료해야 한다.

엔티티가 저장될 때까지 식별자 생성이 지연되면 또 다른 문제점이 발생한다.

> 둘 이상의 새로운 엔티티를 java.util.Set에 추가해야 하는 경우
> 
> 식별자가 아직 할당되지 않았다면, 해당 식별자와 다른 새로운 엔티티의 식별자가 같아질 수 있다.  
> 엔티티의 equals() 메서드로 식별자를 비교하면 Set에 새롭게 추가도니 엔티티가 같은 객체로 보인다.  
> 오직 처음으로 추가된 객체만이 포함되고 나머지는 제외된다.
 
이를 해결할 방법으로는 식별자 생성을 빠르게 완료해야 한다.  
클라이언트는 ProductRepository에게 다음 식별자를 쿼리하고, 이를 Product의 생성자로 전달하여 인스턴스화한다.