# 04. 아키텍처

DDD의 가장 큰 장점 중 하나는 특정 아키텍처의 사용을 요구하지 않는다는 점이다.

### 계층

계층 아키텍처 패턴은 모든 패턴의 할아버지쯤으로 여겨진다.

이 아키텍처의 중요한 규칙은 각 계층이 자신의 층과 바로 아래층에만 연결될 수 있다는 점이다.  
엄격한 계층 아키텍처는 바로 아래층과만 연결되도록 하는 구조이다.  
느슨한 계층 아키텍처는 상위 계층이 그 아래의 모든 계층과 연결되도록 한다.  
사용자 인터페이스와 애플리케이션 서비스는 대부분 인프라를 이용하기 때문에 대부분의 시스템이 느슨한 계층을 기반으로 한다.

사용자 인터페이스는 사용자의 뷰와 요구사항 문제를 다루는 코드만 포함한다.  
여기에 도메인/비즈니스 로직을 담아서는 안된다.

사용자 인터페이스의 컴포넌트는 애플리케이션 계층과 바로 연결되는 클라이언트다.  
애플리케이션 서비스는 애플리케이션 계층에 위치한다.  
도메인 서비스와 다르며, 도메인 로직이 전혀 없다.  
여기선 영속성 트랜잭션과 보안을 제어할 수 있다.

사용자 인터페이스로부터 매개변수를 받아 리파지토리를 사용해 애그리게잇 인스턴스를 획득하고, 몇 가지 커맨드 오퍼레이션을 수행하는 일이 애플리케이션 서비스의 공통 기능으로 포함된다.  
애플리케이션 서비스는 새로운 애그리게잇을 생성하기 위해 팩토리를 사용하거나, 애그리게잇의 생성자가 새로운 인스턴스를 생성하도록 해서 그에 맞는 리파지토리를 통해 저장시킨다.  
또한 무상태 오퍼레이션으로 설계된 일부 도메인별 태스크를 완성하기 위해 도메인 서비스를 사용할 수도 있다.

그런데 전통적인 계층을 사용하면 도메인과 관련된 몇 가지 문제가 발생한다.

#### 의존성 역행 원리

의존성이 영향을 주는 방식을 조정함으로써 전통적인 계층 아키텍처를 개선하는 방법이 하나 있다.

하위 수준의 서비스를 제공하는 컴포넌트가 상위 수준의 컴포넌트에서 정의한 인터페이스에 의존해야 한다는 것이다.

도메인 계층에 초점을 맞춰보면, DIP를 사용함으로써 도메인과 인프라 모두가 도메인 모델에서 정의한 추상화(인터페이스)에 의존하게 된다.

### 헥사고날 또는 포트와 어댑터

다양한 이질적 클라이언트가 동등한 지위에서 시스템과 상호작용하도록 함으로써 그 목표를 달성한다.  
새로운 클라이언트가 필요하다면 단순히 내부 애플리케이션의 API가 클라이언트의 입력을 이해하도록 변환해주는 어댑터만 추가하면 된다.

### 서비스 지향

### REST: 표현 상태 전송

### 커맨드-쿼리 책임 분리

### 이벤트 주도 아키텍처

### 데이터 패브릭과 그리드 기반 분산 컴퓨팅