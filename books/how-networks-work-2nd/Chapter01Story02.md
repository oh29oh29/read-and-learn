# 02. 웹 서버의 IP 주소를 DNS 서버에 조회한다

### IP 주소의 기본

HTTP 의 메시지를 만들면 OS 에 의뢰하여 엑세스 대상의 웹 서버에 송신한다.  
이때 URL 안에 스여있는 서버의 도메인명에서 IP 주소를 조사해야 한다.

![IP 의 기본 개념](images/IMG_01_02_01.png)

TCP/IP 네트워크는 작은 서브넷을 라우터로 연결하여 전체 네트워크를 완성한다.  
1. 서브넷을 주소의 동에 해당하는 것으로 생각하고 ㅇㅇ동 ㅇㅇ번지 라는 형태의 네트워크 주소를 할당한다.  
2. 통신 데이터의 받는 사람 기입란에 액세스 대상의 주소를 기입하여 데이터를 보낸다.
3. 라우터가 받는 사람을 보고 이것이 어느 방향에 있는지 조사하여 그 방향으로 데이터를 중계한다.  
4. 이 중계 동작을 반복하면 액세스 대상에 데이터가 도착한다.

### 도메인명과 IP 주소를 구분하여 사용하는 이유

숫자를 나열한 IP 주소는 기억하기 어렵기 때문에 도메인명으로 쓸 수 있도록 하였다.

그렇다면 IP 주소 같은 것은 없애고 이름으로 상대를 지정하여 통신하는 것은 어떨까?  
실제 효율이라는 관점에서 보면 좋은 방법이 아니다.

IP 주소는 32비트, 즉 4바이트에 해당하는 개수밖에 없지만, 도메인명은 수십 바이트에서 255바이트까지의 문자를 취급해야 해서 라우터가 부하되어 데이터를 운반하는 동작에 더 많은 시간이 걸리게 된다.  
따라서 도메인명을 그대로 사용하여 상대와 통신하는 것은 현명한 방법이 아니다.

사람은 도메인명을 사용하고, 라우터는 IP 주소를 사용한다는 방법이 고안되었고, 현재 이 방법이 정착되었다.  
도메인명을 알면 IP 주소를 알 수 있다거나 IP 주소를 알면 도메인명을 알 수 있따는 원리를 사용하여 양쪽의 차이를 해소하면 모두 좋아지는데, 그 원리가 DNS 이다.

### Socket 라이브러리가 IP 주소를 찾는 기능을 제공한다

IP 주소를 조사한다  
= 가장 가까운 DNS 서버에 'www.naver.com 이라는 서버의 IP 주소를 가르쳐 주세요' 라고 질문한다  
= name resolution

DNS 서버에 조회한다  
= DNS 서버에 조회 메시지를 보내고, 반소오디는 응답 메시지를 받는다  
= DNS 서버에 대해 클라이언트로 동작한다

DNS 클라이언트에 해당하는 것을 DNS resolver 또는 resolver 라고 부른다.  
resolution 을 실행하는 것이 resolver 이다.

resolver 의 실체는 Socket 라이브러리에 들어있는 부품화한 프로그램이다.  
Socket 라이브러리는 OS 에 포함되어 있는 네트워크의 기능을 애플리케이션에서 호출하기 위한 부품을 모아놓은 것이다.  
resolver 는 그 속에 들어있는 프로그램 부품의 하나.

### 리졸버를 이용하여 DNS 서버를 조회한다

resolver 를 호출하면 resolver 가 DNS 서버에 조회 메시지를 보내고, DNS 서버에서 응답 메시지가 돌아온다.
- 응답 메시지에 IP 주소가 포함
- resolver 는 이것을 추출하여 브라우저에서 지정한 메모리 영역에 저장

브라우저가 웹 서버에 메시지를 보낼때는 메모리 영역에서 IP 주소를 추출하여 HTTP 의 요청 메시지와 함께 OS 에 전달하여 송신을 의뢰한다.

### 리졸버 내부의 작동

1. 네트워크 애플리케이션(브라우저)이 resolver 를 호출하면 제어가 resolver 내부로 이동
2. resolver 에서 DNS 서버에 문의하기 위한 메시지를 생성
3. 메시지를 DNS 서버에 전송 (resolver 가 스스로 실행하는게 아닌, OS 내부에 포함된 프로토콜 스택을 호출하여 실행을 의뢰)
    - 프로토콜 스택에서 메시지를 보내는 동작을 실행하여 LAN 어댑터를 통해 메시지가 DNS 서버에 송신
4. 메시지를 받은 DNS 서버는 조회 내용을 조사
5. 액세스 대상의 웹 서버가 DNS 서버에 등록되어 있으면 응답 메시지를 만들어서 클라이언트에 반송

DNS 서버에 메시지를 송신할 때도 DNS 서버의 IP 주소가 필요하다.  
단, 이것은 TCP/IP 설정 항목의 하나로 컴퓨터에 미리 설정되어 있으므로 다시 조사할 필요는 없다.