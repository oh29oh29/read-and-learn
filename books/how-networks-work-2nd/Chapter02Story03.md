# 03. 데이터를 송∙수신한다

### 프로토콜 스택에 HTTP 리퀘스트 메시지를 넘긴다

애플리케이션이 `write` 를 호출하여 송신 데이터를 프로토콜 스택에 건네주는 곳부터 시작된다.

![송신](images/IMG_02_02_02.png)

프로토콜 스택은 받은 데이터의 내용을 알지 못한다.  
`write` 를 호출할 때 송신 데이터의 길이를 지정하지만, 프로토콜 스택은 해당 길이만큼만 바이너리 데이터가 1 바이트씩 차례로 나열되어 있다고 인식할 뿐이다.

받은 데이터를 곧바로 송신하지 않고, 내부 송신용 버퍼 메모리 영역에 저장하고, 애플리케이션이 다음 데이터를 건네주기를 기다린다.  
송신을 의뢰할 때 애플리케이션에서 프로토콜 스택에 건네주는 데이터의 길이는 애플리케이션의 종류나 만드는 방법에 따라 결정된다.  
따라서 데이터를 곧바로 보내는 방법이라면 작은 패킷을 많이 보낼 수도 있다. 그러면 네트워크의 이용 효율이 저하되므로 어느 정도 데이터를 저장하고 나서 송∙수신 동작을 한다.

애플리케이션에서 송신의 타이밍을 제어하는 옵셔도 존재한다.  
'버퍼에 머물지 않고 바로 송신할 것' 이라고 지정하면 프로토콜 스택은 버퍼에 머물지 않고 송신 동작을 실행한다.  
브라우저와 같이 대화형 애플리케이션이 서버에 메시지를 보낼 때는 버퍼에 머무는 부분만큼 응답 시간이 지연되므로 이 옵션을 사용하는 경우가 많다.

### 데이터가 클 때는 분할하여 보낸다

송신 버퍼에 들어있는 데이터를 맨 앞부터 차례대로 크기에 맞게 분할하고, 분할한 조각을 한 개씩 패킷에 넣어 송신한다.  
송신 버퍼에 저장한 데이터 조각의 모습을 가늠하여 데이터 조각을 송신하면 맨 앞부분에 TCP 헤더를 부가한다.  
그리고 소켓에 기록되어 있는 제어 정보를 바탕으로 송신처 포트 번호나 수신처 포트 번호 등 필요한 항목을 기록하고, IP 담당 부분에 건네주어 송신 동작을 실행한다.